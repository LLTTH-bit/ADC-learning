# ADI Data Converter Chapter5

P306应该是pdf的34页

## 数据转换器规格和测试的简要历史概述

尽管在这本书的第一张中，已经概述了数据转换器的历史，数据转换器的规格以及相关测试方法的发展仍然值得这一章中额外的评论。去指出为什么，尤其是DSP为基础的测试方法，会变成今天的ADC的广泛接受的测试方法，是很有趣的。

自1940年延续至今的数据转换器的发展，仍然可以根据采样频率大致地划分为两种：低速（通常与更高的精度相关联，最高可达24-bits）和高速（通常与低精度相关联，但最近也发展到了14-16bits，因此界限变得不那么清晰）。这在20世纪40-50年代是相当正确的，那时候用在Bell System中用于PCM（脉冲编码调制）的ADC和DAC一般需要100k范围左右的采样频率，分辨率5-9bits.这些数据转换器通常使用ADC和匹配的DAC测试。通过背靠背方式连接（组成一个编码-译码器coder-decoder，或者叫codec），因为这个组合的性能就能决定整个系统的性能。来自模拟测试信号生成器的模拟信号驱动了ADC，而模拟测试设备是用来测试DAC生成的信号的。待会儿会讨论。背对背测试在高到大约（or so）12bits分辨率的时候依然有重要作用，尤其是在ADC性能的2初步估计。
>如下文中所说，所谓“背对背”测试方式，应该就是使用性能更好的DAC，将ADC生成的数字码重建为模拟信号，再进行观察或测量。

第一个通用的商业数据转换器出现在20世纪50年代中期，由Bernard M.Gordon于1954年在Epsco设计的11bits，50kSPS的DATRAC真空管转换器开创。Gordon自己是定义数据转换器性能的先驱，尤其是哪些高精度应用相关的性能，并且写了很多转换器规格相关的文章。

在20世纪60年代，随着固态数据转换器和大型计算机的出现，对ADC和DAC的兴趣迅速增长。早期的驱动力是数据分析，仪器，PCM，以及雷达应用。

在交流应用中，由于缺少低成本内存和随时可用的数字计算机，那时候仍然没有办法去直接测量所谓的“采样”ADC的频域性能。任何频域性能特性都必须使用“背对背”方式测试，需要使用比被测ADC的动态和静态性能更好的重建DAC。

到20世纪70年代中期，迷你计算机（比如DEC的PDP系列）使得使用快速傅里叶变换（FFT）的频域测试对ADC生产商而言变得实际。IEEE-488总线成为了将数据从包含ADC采样的缓冲内存转移到用来分析的电脑中的一个方便的途径。

同样在20世纪70年代，ADC和DAC再像数字视频中的全新应用使得特定应用的测试成为了一个需求。

20世纪80年代见证了ADC交流测试方面的广泛发展。生产商们开始在一些交流规格上进行标准化，比如SNR，SINAD，ENOB，THD，等等，这些规格组成了采样ADC的全部数据手册。这些规格对通信领域的新兴（emerging）应用而言十分重要，在这里宽动态范围至关重要（of utmost importance）。

除了ac测试的演变，用于测试ADC静态DNL和INL性能的直方图测试法几乎（virtually）取代了老的方法。

到20世纪90年代，ADC和DAC的频域测试方法成为常态，随时可用的FFT软件，个人电脑，以及生产商的评估板，使得这种方法对大部分消费者而言都容易掌握。今天（2004），除了设计用于测量应用的高分辨率ADC，几乎所有的采样ADC都以交流性能为特征。尽管行业中有一些这样那样的不一致，大部分生厂商基本都采用了本书第二章中讨论的一套规格和相关术语。

## 静态ADC测试

像我们在前一部分（Section 5.1 DAC测试）看到的一样，DAC的静态测试基本由：测量不同的数字输入码对应的输出电压组成。对于特定的DAC结构以及对应的错误特性的知识也许能允许在实际电压测量中少测一点。但这只会加速测试时间，不会改变基本的测试方法和概念。

在一个DAC中，无论DNL与INL误差如何，对每个数字输入码，都有一个特定的输出电压。但对一个ADC，对一个输出码，并没有一个特定的输入电压--有一个1LSB宽的输入电压区域（对无噪ADC）将会产生相同的数字码。这被称为：*量化不确定性*，这在指定和测量ADC静态转移特性时或许会引起困惑。图5.26展示了定义ADC模拟输入和数字输出码的两个可能的方法：![5.26](5.26.png)

方法A考虑码字中心定义了静态传递特性（看图，也就是连接量化区间的中心得到了转移曲线）。但是，由于量化不确定性，这些点不能被直接测量。方法B考虑码字转移点定义了静态传递特性，这些点可以被直接测量。用于测量码字转变需要的全部。是一个模拟电压源和一个连接到ADC输入端的DVM（数字电压表？图5.28中有）和观察数字输出的方式，比如LED显示（也就是找一个仪器或电子设备显示数字输出）。模拟输入在不断变化，直到LED等在两个码之间“颤动（flutter）”，输入电压被记录了下来。但需要注意的是，只有在输入相关的噪声峰峰值在1LSB以内时这个方法才能很好地工作。更大的输入相关噪声会遮盖转移点，并让测量变得越来越困难。

但是，假定ADC是相对无噪地，并且转移可以简单地测量。一旦知道了码的转移点，码的中间位置就能被计算出来，就是码的转移点的中间电压。但实际上，整个ADC传递函数可以被整体地通过码的转移点来定义，如图5.26B中所示。注意到，码的转移点相对于图A中理想ADC的码中点定义曲线平移了1/2个LSB。直接使用码转移点定义的优点是：对一个特定的码，DNL就是简单的对应码转移点的差值。

使用码中点定义法会导致误导的结果，像图5.27中展示的那样：
![5.27](5.27.png)
注意ADC传递函数有交替的宽窄码，但通过端点画出的线有着完美的INL。另一边，通过转移点画出的线能够展现出真实的INL是1/2LSB.

图5.28展示了一个用于测量ADC转移点的简单测试装置（setup名词义，equipment designed to serve a specific function）：![5.28](5.28.png)
模拟输入从精准低噪声电压源驱动，ADC的数字输出通过LED显示来观察。通过显示ADC输出每一位的真值和补码（也就是原始值和取反后的值），调整ADC使得那些“颤动”的bits对应的真值和补码的LED显示的亮度一致，就可以确定码转移点的精确值。如果ADC的输出是串行格式的，那么还需要额外的逻辑电路。

尽管十分简单，这种手动的（manual）测试装置对于ADC来说十分有用，尤其是仅有码转移点需要测试的时候，比如测试失调和增益误差。图5.29展示了考虑码转移点时测量ADC增益和失调误差的细节。这个例子是一个3-bitADC，但适用于任何分辨率的情况：![5.29](5.29.png)
注意到，对一个理想ADC，第一个码转移点，也就是从000转变为001的点（命名为$V_{001}$），出现在模拟输入为0.5LSB的地方；而最后一个码转移点，也就是从110转变为111的点（命名为$V_{111}$），出现在模拟输入为 FS-1.5LSB 的地方，遵循之前图5.26B中的约定。
图5.29中的定义适用于单极性ADC，但可以简单地修改成双极性ADC。在一个双极性ADC中（如本书第二章讨论的那样）的约定是：零电压输入落在码100...0的中心(100...0应该对应的是零电压正负0.5LSB的区间)，而相邻的码转移点分别在零电压的上下0.5LSB.在DAC的情况，ADC的双极性零值是令人感兴趣的，可以简单地计算出码转移值。

### 背对背静态ADC测试

另一种有用的静态ADC测试方法能追溯到早期的数据转换器，包括将DAC连接到ADC的输出，并使用传统的模拟测试方法测量ADC性能。“背对背”方法的成功取决于能够否获得一个精度显著高于待测ADC的合适的DAC。例如，一个12-bit的ADC需要至少14-bit精度的DAC，尽管只有12bit的DAC被实际使用了。

图5.30展示了一个背对背测试的装置，通过生成ADC传递函数的误差波形来测试ADC静态性能：![5.30](5.30.png)
ADC驱动着一个精准的DAC，而DAC的输出减去了ADC的输入，放大（如果需要的话），滤波后用示波器观察。减法功能是通过在驱动DAC前对ADC输出码取反实现的，因此DAC输出是ADC输入的反向量化。一个使用电位器实现的简单的电阻加法器可以用来结合信号（理解：将取补，也就是取反后的信号与原信号相加，就实现了减法）。很低频的线性斜坡信号（5.30中的RAMP INPUT）被加到ADC上，并调整电位器来消除（null out）ADC和DAC之间的增益差异的影响。线性斜坡信号输入让错误波形更容易解释，因为水平轴（时间）可以直接在LSB中校准（也就是输入信号与时间成正比）。如果需要，DAC的更新时钟可以是ADC的时钟的约数倍（DAC是低频），来缓解对DAC的稳定时间（settling time）需求，让错误波形更容易来观察。示波器输入端的低通滤波器能有效移除那些可能会模糊实际的错误波形的高频分量。

图5.31A,B,C展示了由ADC的不同的错误导致的几种典型的错误波形：![5.31](5.31.png)
注意到锯齿形的错误波形由一些“牙齿”组成。牙齿的宽度对应着码宽，可以用来直接地测量DNL，如图5.31A中所示。沿着水平轴的垂直虚线展示了理想码转移点应该出现的位置，正与负的DNL的效果都在图中展示了出来，包括失码。

每个牙齿的高度由DAC决定，如果有失码，高度将会对应2LSB，而不是1LSB.图5.31B展示了非单调的情况，表示为箭头所示的误差波形的方向的临时反转。

>**关于“非单调（non-monotonic）”的理解：** 对于单调的情况，当error发生跳变时，都是向下跳变的，而这里向上跳变，也就是发生了反转。
对应的实际情况可能是：原来的输出码为011，增大之后变成了010，对应的值减小，这就是非单调。

当“背对背”方法用来进行静态DNL测量时，一个有着精准直流偏置调整的低幅度三角波工作地最好。直流偏置可以缓慢地调整，DNL误差波形会扫过整个ADC的区间。如果误差波形的频率过高，误差分量就不能观察。
另一方面，INL的测量，应该使用满量程三角波来进行，误差曲线与端点连接线的最大偏差可以用来计算INL，如图5.31C中所示。在这种情况下，没有必要观察构成整体误差波形的每一个单独的牙齿。应该调整平衡电位器，使两端在同一水平，使能够测量INL。图5.31中最坏情况的INL大约有+1LSB.

>**关于INL的看法：**
XY轴是相关的。在5.31A中，跳变点与垂直的虚线的距离就是INL；
同时，在垂直方向上也能观察INL。对于5.31C，标注着“1 LSB”的上边界就是理想情况的跳变点。跳变点在垂直方向上与这个点差多少，INL就是多少。

总而言之，“背对背”方法是在简单的台架测试装置中测量静态ADC线性的有用工具。随着ADC分辨率上升，输入信号的频率需要低一点，误差波形的幅度会降低，而ADC噪声和DAC误差的影响就会显著。

这项技术最适用于12-bit或者更低分辨率的ADC，同时转移噪声（也即：输入相关的噪声）低于1LSB的十分之一的情况。对12-bit ADC的测量需要相当小心，把这项技术扩展到14-bit是十分困难的。对于16-bitADC的测量至少需要18-bit精度的DAC，这样的规格在传统的直流规格中是并不广泛使用的。

### ADC线性度的交叉图测量

用于测量ADC线性度的交叉图方法发展于数据转换器早期，作为一个测量微分和积分线性的简单方法。这种测试适用于不需要高精确度的快速评估。这个概念与之前描述的“背对背”方法几乎一致，除了只有2-3个ADC的LSB被转换回了模拟形式。图5.32展示了交叉图测试的基本测试装置：![5.32](5.32.png)

两个电阻被用来做一个简单的DAC，重建ADC输出的两位LSB。一个精准的DAC给ADC提供直流输入，一个低幅度的三角波用于调制直流电平。同“背对背”测试方法一样，示波器的水平轴可以根据LSB校准。2-bit DAC的输出是一个四级阶梯状的波形，如图5.32中展示。交叉图方法起初是为了测试围绕着内部二进制加权的DAC设计的逐次逼近式ADC来开发的。

如同这章前面讨论过的，叠加在这种DAC中成立，因此SRA ADC才会基于这样一个DAC。不需要检查所有的码，只要关注主要进位即可。作测试时，精准的DAC能够提供与特定的被测主要进位的码转移点对应的直流电平。示波器的水平轴可以根据LSB校准。图5.33中展示的三个波形描绘了DNL误差和一个失码误差：![5.33](5.33.png)
注意到，这种方法不能精准地检测待测主要进位上下地两个以上的失码。同样，当测试其他的不是逐次逼近结构的ADC时，会失去简洁和效率，因为这时需要测试更多的码。

### 伺服环路（servo-loop）码转移点测试

图5.34中展示的伺服环路码转移点测试装置适用于自动测量，无论是作为ATE系统的一部分，还是在以PC为基础的系统中。
![5.34](5.34.png)

该回路从配置为积分器的运算放大器（op amp）开始。在积分器输入端的开关（通常是CMOS）用来在正负电压源直接选择。在积分器输入端有直流电平，那么一个线性斜坡信号就会生成，被ADC所采样。

>**积分电路**：
虽然有点忘记了，但是这个电路还是挺简单的。
根据运放的虚短虚断，回路上电流为恒定值。$I=C\frac{dU}{dt}$，那么电压就是线性变化的。

ADC的输出进入数字比较器的输入“A”端，而输入“B”端是指定的待测码转移点。如果ADC的输出小于指定的码字，也就是$A < B$，那么此时积分器输入端连接负电压源，积分器的输出就会上升。在$A\geq B$的点，正电压源会连接到积分器输入端，那么积分器的输出就会减小。

伺服环路的反馈让振荡继续，产生一个三角波，**这个三角波以码转移点为直流电平中心**。积分器输出处的电压表提供了码转移点的精确测量。当环路时间常数恰当调整时，三角波的幅度应该是一个LSB的一小部分。

>**对伺服环路法的理解：**
B输入是指定的码转移点。当输入电压小于这个点，让输入上升；大于则让输入下降。由于ADC不可能完全精准，积分器的输出（ADC的输入）就会在实际的转移点上下徘徊而振荡。通过看数字电压表的值就能确定这个值。

这项技术可以被用于测量传递函数的端点，例如，第一个和最后一个转移点，也就是$V_1,V_{N-1}$。根据这些值可以计算**标称LSB（nominal LSB）**：
$$LSB_{NOM}=\frac{V_{N-1}-V_1}{2^N -2}$$

端点码转移点和标称LSB权重提供了对任意想要的转移点而言计算DNL和INL所需的信息。增益和失调误差也能从端点码转移点计算出来。

ADC中的迟滞（hysteresis）与噪声能给伺服环路测试方法带来问题。在一些情况下，控制积分器的之间常数是有益的，从一个较短的时间常数开始，获得更快的初始响应，然后以更长的时间常数结束，来获得更高的精准度。

### 基于计算机的伺服环路ADC测试仪
